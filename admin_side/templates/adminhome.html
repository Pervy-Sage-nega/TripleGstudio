
{% extends 'admin-nav-footer-template/base.html' %}
{% load static %}

{% block title %}Admin Dashboard | Triple G BuildHub{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/admincss/nav.css' %}">
    <link rel="stylesheet" href="{% static 'css/sitecss/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/admincss/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/admincss/adminhome.css' %}">
    <link rel="stylesheet" href="{% static 'css/admincss/blog-management.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   
{% endblock %}

{% block content %}
    <div class="container">
        <!-- Header -->
        <div class="page-header">
            <div class="page-title">
                <i class="fas fa-gauge"></i>
                <h1>Admin Dashboard</h1>
            </div>
            <div class="quick-actions">
                <a class="btn btn-primary" href="{% url 'portfolio:projectmanagement' %}"><i class="fas fa-plus"></i> Add New Project</a>
                <a class="btn btn-secondary" href="{% url 'admin_side:assign_project' %}"><i class="fas fa-tasks"></i> Assign Projects</a>
                <a class="btn btn-outline" href="{% url 'admin_side:admin_user_list' %}"><i class="fas fa-users-cog"></i> Manage Users</a>
            </div>
        </div>

        <!-- Top Stats -->
        <div class="grid" style="grid-template-columns: repeat(12, 1fr);">
            <div class="card" style="grid-column: span 3;">
                <div class="stat">
                    <div class="icon blue"><i class="fas fa-diagram-project"></i></div>
                    <div class="meta">
                        <span class="label">Total Projects</span>
                        <span class="value" id="totalProjects">{{ total_projects }}</span>
                    </div>
                </div>
            </div>
            <div class="card" style="grid-column: span 5;">
                <div class="stat">
                    <div class="icon green"><i class="fas fa-spinner"></i></div>
                    <div class="meta" style="width:100%">
                        <span class="label">Ongoing Projects</span>
                        <span class="value" id="ongoingCount">{{ ongoing_projects }}</span>
                        <div class="progress" aria-label="Overall progress">
                            <span id="ongoingProgress" style="width: {{ avg_progress }}%;"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card" style="grid-column: span 4;">
                <div class="stat">
                    <div class="icon amber"><i class="fas fa-clipboard-check"></i></div>
                    <div class="meta">
                        <span class="label">Pending Site Manager Approvals</span>
                        <span class="value" id="pendingCount">{{ pending_site_managers }}</span>
                        <div style="margin-top:8px;">
                            <a href="{% url 'admin_side:admin_user_list' %}" class="btn btn-primary btn-sm"><i class="fas fa-bolt"></i>
                                Review Now</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Row: Recent Diary, Client Requests, Notifications -->
        <div class="grid" style="margin-top: 16px;">
            <!-- Recent Site Diary Entries -->
            <div class="card" style="grid-column: span 6;">
                <div class="section-header">
                    <div class="section-title"><i class="fas fa-book"></i> Recent Site Diary Entries</div>
                    <a href="#" class="btn btn-outline"><i class="fas fa-list"></i> View All</a>
                </div>
                <ul class="list" id="recentDiary">
                    {% for entry in recent_diary_entries %}
                    <li class="list-item">
                        <div class="left">
                            <span class="badge">{{ entry.entry_date|date:"M d" }}</span>
                            <div>
                                <div><strong>{{ entry.project.name }}</strong> â€” {{ entry.work_description|truncatewords:5 }}</div>
                                <small>By {{ entry.created_by.get_full_name|default:entry.created_by.username }}</small>
                            </div>
                        </div>
                        <a href="#" class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i> View</a>
                    </li>
                    {% empty %}
                    <li class="list-item">
                        <div class="left">
                            <div>No diary entries available</div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Pending Project Approvals -->
            <div class="card" style="grid-column: span 3;">
                <div class="section-header">
                    <div class="section-title"><i class="fas fa-clock"></i> Pending Approvals</div>
                </div>
                <ul class="list">
                    {% for project in pending_projects %}
                    <li class="list-item">
                        <div class="left">
                            <i class="fas fa-circle" style="color:#f59e0b"></i>
                            <div>
                                <div><strong>{{ project.name|truncatewords:3 }}</strong></div>
                                <small>{{ project.client_name }}</small>
                            </div>
                        </div>
                        <span class="badge" style="background:#fef3c7;color:#92400e">Pending</span>
                    </li>
                    {% empty %}
                    <li class="list-item">
                        <div class="left">
                            <div>No pending approvals</div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                <div style="margin-top:12px;">
                    <a href="{% url 'site_diary:adminclientproject' %}" class="btn btn-primary" style="width:100%"><i class="fas fa-tasks"></i> Review All</a>
                </div>
            </div>

            <!-- Notifications -->
            <div class="card" style="grid-column: span 3;">
                <div class="section-header">
                    <div class="section-title"><i class="fas fa-bell"></i> Notifications</div>
                    <a href="#" class="btn btn-outline btn-sm"><i class="fas fa-gear"></i></a>
                </div>
                <ul class="list" id="notifications">
                    {% for notification in recent_notifications %}
                    <li class="list-item">
                        <div class="left"><i class="fas {{ notification.icon }}" style="color:{{ notification.color }}"></i> {{ notification.message }}</div>
                        <small>{% if notification.time.total_seconds < 3600 %}{{ notification.time.total_seconds|floatformat:0|add:"0"|slice:":2" }}m{% elif notification.time.total_seconds < 86400 %}{{ notification.time.total_seconds|floatformat:0|add:"0"|slice:":2" }}h{% else %}{{ notification.time.days }}d{% endif %}</small>
                    </li>
                    {% empty %}
                    <li class="list-item">
                        <div class="left">No recent notifications</div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Bottom Row: Blog Management Shortcut and Quick Access -->
        <div class="grid" style="margin-top: 16px;">
            <div class="card" style="grid-column: span 8;">
                <div class="section-header">
                    <div class="section-title"><i class="fas fa-blog"></i> Blog Management</div>
                    <div class="blog-actions">
                        <a href="{% url 'blog:createblog' %}" class="btn btn-primary"><i class="fas fa-plus"></i> New Post</a>
                        <a href="{% url 'blog:blogmanagement' %}" class="btn btn-secondary"><i class="fas fa-cog"></i> Manage</a>
                    </div>
                </div>
                <div class="blog-stats">
                    <div class="stat-item">
                        <span class="stat-number">{{ total_posts|default:"0" }}</span>
                        <span class="stat-label">Total Posts</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">{{ published_posts|default:"0" }}</span>
                        <span class="stat-label">Published</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">{{ draft_posts|default:"0" }}</span>
                        <span class="stat-label">Drafts</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">{{ pending_posts|default:"0" }}</span>
                        <span class="stat-label">Pending</span>
                    </div>
                </div>
                <div class="recent-posts">
                    <h4>Recent Posts</h4>
                    <ul class="post-list">
                        {% for post in recent_posts %}
                        <li><a href="{% url 'blog:blog_detail' post.slug %}">{{ post.title|truncatechars:40 }}</a> <span class="post-status {{ post.status }}">{{ post.get_status_display }}</span></li>
                        {% empty %}
                        <li>No recent posts available</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="card" style="grid-column: span 4;">
                <div class="section-header">
                    <div class="section-title"><i class="fas fa-bolt"></i> Quick Actions</div>
                </div>
                <div class="quick-actions-grid">
                    <a class="quick-action-item" href="{% url 'portfolio:projectmanagement' %}">
                        <i class="fas fa-plus-circle"></i>
                        <span>Add Project</span>
                    </a>
                    <a class="quick-action-item" href="{% url 'blog:createblog' %}">
                        <i class="fas fa-pen"></i>
                        <span>Write Blog</span>
                    </a>
                    <a class="quick-action-item" href="{% url 'admin_side:admin_user_list' %}">
                        <i class="fas fa-user-gear"></i>
                        <span>Manage Users</span>
                    </a>
                    <a class="quick-action-item" href="{% url 'admin_side:assign_project' %}">
                        <i class="fas fa-tasks"></i>
                        <span>Assign Projects</span>
                    </a>
                    <a class="quick-action-item" href="{% url 'admin_side:security_logs' %}">
                        <i class="fas fa-shield-alt"></i>
                        <span>Security Logs</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <script src="{% static 'js/adminjs/mobile-btn.js' %}"></script>
    <script src="{% static 'js/adminjs/admin-logout.js' %}"></script>
{% endblock %}
