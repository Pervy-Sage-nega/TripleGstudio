{% extends 'admin-nav-footer-template/base.html' %}
{% load static %}
{% block title %}Admin Message Center | Triple G BuildHub{% endblock %}
{% block extra_head %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="user-role" content="admin">
    <link rel="stylesheet" href="{% static 'css/sitecss/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/sitecss/history.css' %}">
    <link rel="stylesheet" href="{% static 'css/sitecss/chatbot.css' %}">
    <link rel="stylesheet" href="{% static 'css/admincss/adminmessagecenter.css' %}">
    <link rel="stylesheet" href="{% static 'css/admincss/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/admincss/nav.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
<body>
    {% csrf_token %}
    <div class="container">
        <div class="page-header">
            <div class="page-title">
                <i class="fas fa-comments"></i>
                <h1>Admin Message Center</h1>
                <span class="notification-badge">{{ new_count }}</span>
            </div>
            <div class="export-options">
                <button class="btn btn-primary" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button class="btn btn-primary" id="exportPdfBtn">
                    <i class="fas fa-file-pdf"></i> PDF
                </button>
                <button class="btn btn-primary" id="exportCsvBtn">
                    <i class="fas fa-file-csv"></i> CSV
                </button>
                <button class="btn btn-secondary" id="printBtn">
                    <i class="fas fa-print"></i> Print
                </button>
            </div>
        </div>

        <!-- Status Tracker Section -->
        <div class="summary-section">
            <div class="summary-card">
                <i class="fas fa-envelope summary-icon"></i>
                <div class="summary-title">New Messages</div>
                <div class="summary-value">{{ new_count }}</div>
                <div class="summary-change">
                    <span>Unread messages</span>
                </div>
            </div>
            <div class="summary-card success">
                <i class="fas fa-envelope-open summary-icon"></i>
                <div class="summary-title">Read Messages</div>
                <div class="summary-value">{{ read_count }}</div>
                <div class="summary-change">
                    <span>Read but not reviewed</span>
                </div>
            </div>
            <div class="summary-card warning">
                <i class="fas fa-clipboard-check summary-icon"></i>
                <div class="summary-title">Reviewed</div>
                <div class="summary-value">{{ reviewed_count }}</div>
                <div class="summary-change">
                    <span>Completed reviews</span>
                </div>
            </div>
            <div class="summary-card info">
                <i class="fas fa-archive summary-icon"></i>
                <div class="summary-title">Archived</div>
                <div class="summary-value">{{ archived_count }}</div>
                <div class="summary-change">
                    <span>Archived messages</span>
                </div>
            </div>
        </div>

        <!-- Reports Section with View Toggle -->
        <div class="reports-section">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-comments"></i>
                    Message Activity Timeline
                </div>
                <div class="view-toggle">
                    <button class="view-btn" data-tab="all">All Messages</button>
                    <button class="view-btn" data-tab="new">New</button>
                    <button class="view-btn" data-tab="read">Read</button>
                    <button class="view-btn" data-tab="reviewed">Reviewed</button>
                    <button class="view-btn" data-tab="archived">Archived</button>
                    <button id="timelineViewBtn" class="view-btn active" title="Timeline View">
                        <i class="fas fa-stream"></i> Timeline View
                    </button>
                    <button id="tableViewBtn" class="view-btn" title="Table View">
                        <i class="fas fa-table"></i> Table View
                    </button>
                </div>
            </div>
            
            <div class="content-container">

        <!-- Filter and Search Section -->
        <div class="filter-container">
            <div class="filter-header">
                <div class="filter-title">
                    <i class="fas fa-filter"></i>
                    <span>Filter Messages</span>
                </div>
                <button class="filter-toggle" id="filterToggle">
                    <span>Show Filters</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" placeholder="Search by name, email, or phone...">
            </div>
            
            <div class="filter-content" id="filterOptions" style="display: none;">
                <div class="filter-options">
                    <div class="filter-group">
                        <label for="filter-name">Name</label>
                        <input type="text" id="filter-name" placeholder="Enter name...">
                    </div>
                    <div class="filter-group">
                        <label for="filter-email">Email</label>
                        <input type="text" id="filter-email" placeholder="Enter email...">
                    </div>
                    <div class="filter-group">
                        <label for="filter-phone">Phone Number</label>
                        <input type="text" id="filter-phone" placeholder="Enter phone number...">
                    </div>
                </div>
                <div class="filter-buttons">
                    <div class="button-group">
                        <button class="btn btn-secondary" id="resetFilters">
                            <i class="fas fa-undo"></i> Reset Filters
                        </button>
                        <button class="btn btn-primary" id="applyFilters">
                            <i class="fas fa-search"></i> Apply Filters
                        </button>
                    </div>
                </div>
            </div>
        </div>

                <!-- Timeline View -->
                <div class="timeline-container" id="timelineView">
                    <div class="timeline">
            {% for message in chatbot_messages %}
            <div class="timeline-item status-{{ message.status }}" data-status="{{ message.status }}">
                <div class="timeline-header" data-id="{{ message.id }}">
                    <div class="timeline-date">
                        <div class="timeline-time">{{ message.created_at|date:"g:i A" }}</div>
                        <div class="timeline-status">
                            <span class="status-badge status-{{ message.status }}-badge">{{ message.get_status_display }}</span>
                        </div>
                    </div>
                    <h3>{{ message.name|default:"Anonymous User" }}</h3>
                    <div class="timeline-meta">
                        <span class="entry-id">MSG-{{ message.id|stringformat:"04d" }}</span>
                        <div class="timeline-actions">
                            {% if message.status == 'new' %}
                            <button class="action-btn mark-read" data-message-id="{{ message.id }}" title="Mark as Read">
                                <i class="fas fa-eye"></i>
                            </button>
                            {% elif message.status == 'read' %}
                            <button class="action-btn mark-reviewed" data-message-id="{{ message.id }}" title="Mark as Reviewed">
                                <i class="fas fa-clipboard-check"></i>
                            </button>
                            <button class="action-btn mark-unread" data-message-id="{{ message.id }}" title="Mark as Unread">
                                <i class="fas fa-undo"></i>
                            </button>
                            {% elif message.status == 'reviewed' %}
                            <button class="action-btn archive" data-message-id="{{ message.id }}" title="Archive">
                                <i class="fas fa-archive"></i>
                            </button>
                            <button class="action-btn mark-unread" data-message-id="{{ message.id }}" title="Mark as Unread">
                                <i class="fas fa-undo"></i>
                            </button>
                            {% else %}
                            <button class="action-btn unarchive" data-message-id="{{ message.id }}" title="Unarchive">
                                <i class="fas fa-box-open"></i>
                            </button>
                            {% endif %}
                            <button class="action-btn delete" data-message-id="{{ message.id }}" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                            <div class="action-btn expand">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="timeline-content" id="content{{ message.id }}">
                    <div class="content-grid">
                        <div class="info-section">
                            <div class="info-item">
                                <div class="info-label">Name:</div>
                                <div class="info-value">{{ message.name|default:"Not provided" }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Email:</div>
                                <div class="info-value">{{ message.email|default:"Not provided" }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Phone:</div>
                                <div class="info-value">{{ message.phone|default:"Not provided" }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Submitted:</div>
                                <div class="info-value">{{ message.created_at|date:"F d, Y \a\t g:i A" }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-description">
                        <h4>Message Content</h4>
                        <p>{{ message.message|default:"No message provided" }}</p>
                    </div>
                    <div class="timeline-actions">
                        <button class="btn btn-primary view-entry-btn" data-message-id="{{ message.id }}">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                        <button class="btn btn-secondary">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
                    </div>
                </div>
                
                <!-- Table View -->
                <div class="table-container" id="tableView" style="display: none;">
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Client</th>
                            <th>Phone</th>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for message in chatbot_messages %}
                        <tr data-status="{{ message.status }}">
                            <td>{{ message.created_at|date:"M d, Y â€¢ g:i A" }}</td>
                            <td>
                                <div class="client-name">{{ message.name }}</div>
                                <div class="client-email">{{ message.email }}</div>
                                <span class="log-status status-{{ message.status }}">{{ message.get_status_display }}</span>
                            </td>
                            <td>{{ message.phone|default:"-" }}</td>
                            <td>{{ message.message|truncatechars:50 }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" style="text-align: center; color: #ccc; padding: 40px;">No messages found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
    <script src="{% static 'js/adminjs/mobile-btn.js' %}"></script>
    <script src="{% static 'js/adminjs/adminmessagecenter.js' %}"></script>

{% endblock %}
</body>