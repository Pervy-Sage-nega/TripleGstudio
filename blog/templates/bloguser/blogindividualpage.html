
{% extends 'layout.html' %}
{% load static %}
{% load profile_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    {% block head %} 
  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ meta_tags.title }} | Triple G BuildHub</title>
    <meta name="description" content="{{ meta_tags.description }}">
    <link rel="canonical" href="{{ meta_tags.canonical_url }}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{{ meta_tags.og_type }}">
    <meta property="og:url" content="{{ meta_tags.og_url }}">
    <meta property="og:title" content="{{ meta_tags.og_title }}">
    <meta property="og:description" content="{{ meta_tags.og_description }}">
    <meta property="og:site_name" content="{{ meta_tags.og_site_name }}">
    {% if meta_tags.og_image %}
    <meta property="og:image" content="{{ meta_tags.og_image }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    {% endif %}
    
    <!-- Twitter -->
    <meta property="twitter:card" content="{{ meta_tags.twitter_card }}">
    <meta property="twitter:url" content="{{ meta_tags.og_url }}">
    <meta property="twitter:title" content="{{ meta_tags.twitter_title }}">
    <meta property="twitter:description" content="{{ meta_tags.twitter_description }}">
    {% if meta_tags.twitter_image %}
    <meta property="twitter:image" content="{{ meta_tags.twitter_image }}">
    {% endif %}
    
    <!-- Article Meta -->
    <meta property="article:author" content="{{ meta_tags.article_author }}">
    <meta property="article:published_time" content="{{ meta_tags.article_published_time }}">
    <meta property="article:modified_time" content="{{ meta_tags.article_modified_time }}">
    {% if meta_tags.article_section %}
    <meta property="article:section" content="{{ meta_tags.article_section }}">
    {% endif %}
    {% if meta_tags.article_tags %}
        {% for tag in meta_tags.article_tags %}
        <meta property="article:tag" content="{{ tag }}">
        {% endfor %}
    {% endif %}
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {{ structured_data|safe }}
    </script>
    
    <!-- Breadcrumb Structured Data -->
    <script type="application/ld+json">
    {{ breadcrumb_data|safe }}
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/blogindividual.css' %}">
    {% endblock %}
</head>
<body>
    {% block body %}

    <!-- Blog Post Content -->
    <main class="blog-post-content">
        <div class="container">
            <div class="blog-post-layout">
                <!-- Main Content -->
                <article class="blog-post-main">
                    <!-- Post Header -->
                    <header class="post-header">
                        {% if blog_post.category %}
                        <div class="post-category">
                            <a href="{% url 'blog:category_list' blog_post.category.slug %}" class="category-badge">{{ blog_post.category.name }}</a>
                        </div>
                        {% endif %}
                        <h1 class="post-title">{{ blog_post.title }}</h1>
                        <div class="post-meta">
                            <div class="author-info">
                                <img src="{% profile_image_url blog_post.author %}" alt="{{ blog_post.author.get_full_name|default:blog_post.author.username }}" class="author-avatar">
                                <span class="author-name">{{ blog_post.author.get_full_name|default:blog_post.author.username }}</span>
                            </div>
                            <div class="post-details">
                                <span class="post-date"><i class="fas fa-calendar"></i> {{ blog_post.published_date|date:"F j, Y" }}</span>
                                <span class="read-time"><i class="fas fa-clock"></i> {{ blog_post.reading_time }} min read</span>
                                <span class="post-views"><i class="fas fa-eye"></i> {{ blog_post.view_count }} views</span>
                            </div>
                        </div>
                    </header>

                    <!-- Featured Image -->
                    {% if blog_post.featured_image %}
                    <div class="post-featured-image">
                        <img src="{{ blog_post.featured_image.url }}" alt="{{ blog_post.title }}">
                    </div>
                    {% endif %}

                    <!-- Table of Contents -->
                    {% if blog_post.enable_toc %}
                    <div class="post-toc" id="postToc" style="display: none;">
                        <div class="toc-header">
                            <h3>Table of Contents</h3>
                            <button class="toc-toggle" id="tocToggle"><i class="fas fa-chevron-down"></i></button>
                        </div>
                        <ul class="toc-list" id="tocList">
                            <!-- TOC items will be generated automatically by JavaScript -->
                        </ul>
                    </div>
                    {% endif %}

                    <!-- Post Content -->
                    <div class="post-content">
                        {{ blog_post.content|safe }}
                    </div>

                    <!-- Post Tags -->
                    {% if blog_post.tags.exists %}
                    <div class="post-tags">
                        <h4>Tags:</h4>
                        <div class="tag-list">
                            {% for tag in blog_post.tags.all %}
                                <a href="{% url 'blog:tag_list' tag.slug %}" class="tag-item">{{ tag.name }}</a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Gallery Images -->
                    {% if blog_post.gallery_images.exists %}
                    <div class="post-gallery">
                        <h4>Gallery</h4>
                        <div class="gallery-grid">
                            {% for image in blog_post.gallery_images.all %}
                                <div class="gallery-item">
                                    <div class="post-image-container">
                                        <img src="{{ image.image.url }}" alt="{{ image.alt_text|default:image.caption }}" onclick="openLightbox('{{ image.image.url }}', '{{ image.caption }}')">
                                        {% if image.caption %}
                                            <span class="image-caption">{{ image.caption }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Social Sharing -->
                    <div class="social-sharing">
                        <h4>Share This Article</h4>
                        <div class="share-buttons">
                            <button class="share-btn facebook" data-platform="facebook" title="Share on Facebook">
                                <i class="fab fa-facebook-f"></i>
                                <span>Facebook</span>
                            </button>
                            <button class="share-btn twitter" data-platform="twitter" title="Share on Twitter">
                                <i class="fab fa-twitter"></i>
                                <span>Twitter</span>
                            </button>
                            <button class="share-btn linkedin" data-platform="linkedin" title="Share on LinkedIn">
                                <i class="fab fa-linkedin-in"></i>
                                <span>LinkedIn</span>
                            </button>
                            <button class="share-btn email" data-platform="email" title="Share via Email">
                                <i class="fas fa-envelope"></i>
                                <span>Email</span>
                            </button>
                            <button class="share-btn copy-link" data-platform="copy" title="Copy Link">
                                <i class="fas fa-link"></i>
                                <span>Copy Link</span>
                            </button>
                        </div>
                    </div>

                    <!-- Reading Progress Bar -->
                    <div class="reading-progress">
                        <div class="progress-bar" id="reading-progress-bar"></div>
                    </div>

                    <!-- Author Bio -->
                    <div class="author-bio">
                        <img src="{% profile_image_url blog_post.author %}" alt="{{ blog_post.author.get_full_name|default:blog_post.author.username }}" class="author-avatar">
                        <div class="author-details">
                            <h3>About the Author</h3>
                            <h4>{{ blog_post.author.get_full_name|default:blog_post.author.username }}</h4>
                            <p>{{ blog_post.author.first_name }} {{ blog_post.author.last_name }} is passionate about architecture and sustainable building practices, bringing years of experience to every project.</p>
                            <div class="author-social">
                                <a href="#" target="_blank"><i class="fab fa-linkedin-in"></i></a>
                                <a href="#" target="_blank"><i class="fab fa-twitter"></i></a>
                                <a href="#" target="_blank"><i class="fas fa-globe"></i></a>
                            </div>
                        </div>
                    </div>



                    <!-- Related Articles -->
                    {% if related_posts %}
                    <div class="related-articles">
                        <h3>Related Articles</h3>
                        <div class="related-posts-grid">
                            {% for post in related_posts %}
                            <article class="related-post-card">
                                <div class="related-post-image">
                                    {% if post.featured_image %}
                                        <img src="{{ post.featured_image.url }}" alt="{{ post.title }}">
                                    {% else %}
                                        <img src="{% static 'images/image3.jpg' %}" alt="{{ post.title }}">
                                    {% endif %}
                                </div>
                                <div class="related-post-content">
                                    <h4><a href="{% url 'blog:blog_detail' post.slug %}">{{ post.title }}</a></h4>
                                    <span class="post-date">{{ post.published_date|date:"F j, Y" }}</span>
                                </div>
                            </article>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Comments Section -->
                    <div class="comments-section">
                        <h3>Comments ({{ comments.count }})</h3>
                        
                        <!-- Comment Form -->
                        {% if user.is_authenticated %}
                        <div class="comment-form">
                            <h4>Leave a Comment</h4>
                            
                            <!-- User Profile Info -->
                            <div class="client-comment-info">
                                <div class="client-avatar">
                                    <img src="{% profile_image_url user %}" alt="{{ user.get_full_name|default:user.username }}" id="clientAvatar">
                                </div>
                                <div class="client-info">
                                    <span class="client-name" id="clientName">{{ user.get_full_name|default:user.username }}</span>
                                    {% if user.adminprofile %}
                                        <span class="client-status">{{ user.adminprofile.get_admin_role_display }}</span>
                                    {% elif user.sitemanagerprofile %}
                                        <span class="client-status">Site Manager</span>
                                    {% elif user.profile %}
                                        <span class="client-status">{{ user.profile.get_role_display }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <form id="blogCommentForm" method="post" action="{% url 'blog:add_comment' post_slug=blog_post.slug %}">
                                {% csrf_token %}
                                <input type="hidden" name="parent_id" id="parent_id" value="">
                                
                                <!-- Pre-filled user data (hidden for authenticated users) -->
                                <input type="hidden" name="author_name" id="authorName" value="{{ user.get_full_name|default:user.username }}">
                                <input type="hidden" name="author_email" id="authorEmail" value="{{ user.email }}">
                                
                                
                                <div class="form-group">
                                    <label for="commentContent">Your Comment *</label>
                                    <textarea id="commentContent" name="content" rows="5" class="form-control" required maxlength="1000" 
                                              placeholder="Share your thoughts about this article..."></textarea>
                                    <small class="form-text text-muted">Maximum 1000 characters</small>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">Post Comment</button>
                            </form>
                        </div>
                        {% else %}
                        <!-- Non-authenticated user - disabled form -->
                        <div class="comment-form comment-form-disabled-input">
                            <h4>Leave a Comment</h4>
                            
                            <!-- Disabled user info -->
                            <div class="client-comment-info disabled">
                                <div class="client-avatar">
                                    <img src="{% static 'images/default-avatar.png' %}" alt="Login Required" id="clientAvatar">
                                </div>
                                <div class="client-info">
                                    <span class="client-name">Please log in to comment</span>
                                    <span class="client-status">Guest User</span>
                                </div>
                            </div>
                            
                            <!-- Disabled form -->
                            <form class="disabled-form">
                                <div class="form-group">
                                    <label for="disabled_content">Your Comment *</label>
                                    <textarea id="disabled_content" rows="5" class="form-control" disabled 
                                              placeholder="Please log in to leave a comment and join the discussion..."></textarea>
                                    <small class="form-text text-muted">Login required to post comments</small>
                                </div>
                                
                                <button type="button" class="btn btn-primary" disabled>
                                    <i class="fas fa-lock"></i> Login Required to Post
                                </button>
                            </form>
                            
                            <!-- Login prompt overlay -->
                            <div class="login-overlay">
                                <div class="login-overlay-content">
                                    <div class="login-icon">
                                        <i class="fas fa-user-circle"></i>
                                    </div>
                                    <p>Join the conversation!</p>
                                    <div class="login-buttons">
                                        <a href="{% url 'accounts:client_login' %}" class="btn btn-primary">
                                            <i class="fas fa-sign-in-alt"></i> Login
                                        </a>
                                        <a href="{% url 'accounts:client_register' %}" class="btn btn-outline-primary">
                                            <i class="fas fa-user-plus"></i> Register
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Comments List -->
                        <div class="comments-list">
                            {% for comment in comments %}
                                <div class="comment{% if comment.parent %} nested-comment{% endif %}" data-comment-id="{{ comment.id }}">
                                    <div class="comment-avatar">
                                        {% if comment.author %}
                                            <img src="{% profile_image_url comment.author %}" alt="{{ comment.author_name }}">
                                        {% else %}
                                            <img src="{% static 'images/arkitel.PNG' %}" alt="{{ comment.author_name }}">
                                        {% endif %}
                                    </div>
                                    <div class="comment-content">
                                        <div class="comment-header">
                                            <h4 class="commenter-name">{{ comment.author_name }}</h4>
                                            <span class="comment-date">{{ comment.created_at|date:"F j, Y \a\t g:i A" }}</span>
                                            
                                            <!-- Comment Status Badge -->
                                            {% if comment.status == 'pending' %}
                                                <span class="status-badge pending-badge">Pending Approval</span>
                                            {% endif %}
                                            
                                            <!-- User Role Badges -->
                                            {% if comment.author and comment.author == blog_post.author %}
                                                <span class="author-badge">Post Author</span>
                                            {% elif comment.author.adminprofile %}
                                                <span class="role-badge admin-badge">{{ comment.author.adminprofile.get_admin_role_display }}</span>
                                            {% elif comment.author.sitemanagerprofile %}
                                                <span class="role-badge manager-badge">Site Manager</span>
                                            {% elif comment.author.profile %}
                                                <span class="role-badge client-badge">{{ comment.author.profile.get_role_display }}</span>
                                            {% endif %}
                                        </div>
                                        <p>{{ comment.content|linebreaks }}</p>
                                        <div class="comment-actions">
                                            {% if user.is_authenticated %}
                                                <button class="reply-btn" data-comment-id="{{ comment.id }}">Reply</button>
                                            {% endif %}
                                            <button class="like-btn" data-comment-id="{{ comment.id }}">
                                                <i class="fas fa-thumbs-up"></i> {{ comment.likes }}
                                            </button>
                                            <button class="dislike-btn" data-comment-id="{{ comment.id }}">
                                                <i class="fas fa-thumbs-down"></i> {{ comment.dislikes }}
                                            </button>
                                            {% if user.is_authenticated and comment.author == user %}
                                                <button class="delete-btn" data-comment-id="{{ comment.id }}" title="Delete comment">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Display nested replies -->
                                {% for reply in comment.replies_list %}
                                    <div class="comment nested-comment" data-comment-id="{{ reply.id }}">
                                        <div class="comment-avatar">
                                            {% if reply.author %}
                                                <img src="{% profile_image_url reply.author %}" alt="{{ reply.author_name }}">
                                            {% else %}
                                                <img src="{% static 'images/default-profile.PNG' %}" alt="{{ reply.author_name }}">
                                            {% endif %}
                                        </div>
                                        <div class="comment-content">
                                            <div class="comment-header">
                                                <h4 class="commenter-name">{{ reply.author_name }}</h4>
                                                <span class="comment-date">{{ reply.created_at|date:"F j, Y \a\t g:i A" }}</span>
                                                
                                                <!-- Comment Status Badge -->
                                                {% if reply.status == 'pending' %}
                                                    <span class="status-badge pending-badge">Pending Approval</span>
                                                {% endif %}
                                                
                                                <!-- User Role Badges -->
                                                {% if reply.author and reply.author == blog_post.author %}
                                                    <span class="status-badge author-badge">Author</span>
                                                {% endif %}
                                            </div>
                                            <p>{{ reply.content|linebreaks }}</p>
                                            <div class="comment-actions">
                                                {% if user.is_authenticated %}
                                                    <button class="reply-btn" data-comment-id="{{ reply.id }}">Reply</button>
                                                {% endif %}
                                                <button class="like-btn" data-comment-id="{{ reply.id }}">
                                                    <i class="fas fa-thumbs-up"></i> {{ reply.likes }}
                                                </button>
                                                <button class="dislike-btn" data-comment-id="{{ reply.id }}">
                                                    <i class="fas fa-thumbs-down"></i> {{ reply.dislikes }}
                                                </button>
                                                {% if user.is_authenticated and reply.author == user %}
                                                    <button class="delete-btn" data-comment-id="{{ reply.id }}" title="Delete reply">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% empty %}
                                <div class="no-comments">
                                    <p>No comments yet. Be the first to share your thoughts!</p>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar -->
                <aside class="blog-sidebar">
                    <!-- Newsletter Signup -->
                    <div class="sidebar-widget newsletter-widget">
                        <h3>Stay Updated</h3>
                        <p>Subscribe to our newsletter for the latest articles and industry insights.</p>
                        <form id="newsletterForm">
                            <div class="form-group">
                                <input type="email" placeholder="Your Email Address" required>
                            </div>
                            <button type="submit" class="btn btn-primary full-width">Subscribe</button>
                        </form>
                    </div>
                    
                    <!-- Categories -->
                    <div class="sidebar-widget categories-widget">
                        <h3>Categories</h3>
                        <ul class="category-list">
                            {% for category in categories %}
                            <li><a href="{% url 'blog:category_list' category.slug %}">{{ category.name }} <span>({{ category.post_count }})</span></a></li>
                            {% empty %}
                            <li><a href="#">No categories available</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                    
                    <!-- Popular Posts -->
                    <div class="sidebar-widget popular-posts-widget">
                        <h3>Recent Posts</h3>
                        <div class="popular-posts">
                            {% for post in recent_posts %}
                            <article class="popular-post">
                                <div class="popular-post-image">
                                    {% if post.featured_image %}
                                        <img src="{{ post.featured_image.url }}" alt="{{ post.title }}">
                                    {% else %}
                                        <img src="{% static 'images/image9.jpg' %}" alt="{{ post.title }}">
                                    {% endif %}
                                </div>
                                <div class="popular-post-content">
                                    <h4><a href="{% url 'blog:blog_detail' post.slug %}">{{ post.title|truncatechars:50 }}</a></h4>
                                    <span class="view-count"><i class="fas fa-eye"></i> {{ post.view_count }} views</span>
                                </div>
                            </article>
                            {% empty %}
                            <p>No recent posts available.</p>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Tags -->
                    <div class="sidebar-widget tags-widget">
                        <h3>Popular Tags</h3>
                        <div class="tag-cloud">
                            {% for tag in popular_tags %}
                            <a href="{% url 'blog:tag_list' tag.slug %}" class="tag">{{ tag.name }}</a>
                            {% empty %}
                            <a href="#" class="tag">No tags available</a>
                            {% endfor %}
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

  

    <script src="{% static 'js/blogindividual.js' %}"></script>
    <script src="{% static 'js/blog-comments.js' %}"></script>
 {% endblock %}
</body>
</html>
