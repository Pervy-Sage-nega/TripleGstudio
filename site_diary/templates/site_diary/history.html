{% extends "site_diary/layout_format.html" %}
{% load static %}

{% block head %}
    <title>Site Diary - History</title>
    <link rel="stylesheet" href="{% static 'css/sitecss/history.css' %}">
    <style>
    /* Enhanced Timeline Content Styles */
    .labor-summary, .materials-summary, .equipment-summary, 
    .subcontractor-summary, .delays-summary, .visitors-summary {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 10px;
    }

    .labor-item, .material-item, .equipment-item, 
    .subcontractor-item, .delay-item, .visitor-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px 12px;
        background: #f8f9fa;
        border-radius: 6px;
        font-size: 0.9em;
        flex-wrap: wrap;
    }

    .labor-type, .material-name, .equipment-name, 
    .subcontractor-name, .delay-category, .visitor-name {
        font-weight: 600;
        color: #2c3e50;
    }

    .labor-count, .material-quantity, .equipment-hours,
    .subcontractor-cost, .delay-duration, .visitor-time {
        background: #e3f2fd;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.85em;
        color: #1976d2;
    }

    .labor-overtime {
        background: #fff3e0;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.85em;
        color: #f57c00;
    }

    .equipment-status {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.85em;
        font-weight: 500;
    }

    .status-operational { background: #e8f5e8; color: #2e7d32; }
    .status-maintenance { background: #fff3e0; color: #f57c00; }
    .status-breakdown { background: #ffebee; color: #d32f2f; }
    .status-idle { background: #f5f5f5; color: #757575; }

    .delay-impact {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.85em;
        font-weight: 500;
    }

    .impact-low { background: #e8f5e8; color: #2e7d32; }
    .impact-medium { background: #fff3e0; color: #f57c00; }
    .impact-high { background: #ffebee; color: #d32f2f; }
    .impact-critical { background: #fce4ec; color: #c2185b; }

    .visitor-type, .visitor-company, .material-supplier, 
    .equipment-operator, .subcontractor-work {
        color: #666;
        font-size: 0.85em;
    }

    .issue-item {
        margin-bottom: 12px;
        padding: 12px;
        border-left: 4px solid #ff9800;
        background: #fff8e1;
        border-radius: 0 6px 6px 0;
    }

    .quality-issue {
        border-left-color: #2196f3;
        background: #e3f2fd;
    }

    .safety-incident {
        border-left-color: #f44336;
        background: #ffebee;
    }

    .status-complete {
        background: #e8f5e8;
        color: #2e7d32;
    }

    .status-revision {
        background: #fff3e0;
        color: #f57c00;
    }
    

    
    .timeline-content::-webkit-scrollbar {
        width: 8px;
    }
    
    .timeline-content::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }
    
    .timeline-content::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
    }
    
    .timeline-content::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }
    </style>
    <link rel="stylesheet" href="{% static 'css/sitecss/createblog.css' %}">
    <link rel="stylesheet" href="{% static 'css/sitecss/global-footer.css' %}">
    <link rel="stylesheet" href="{% static 'css/sitecss/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/admincss/nav.css' %}">
    <link rel="stylesheet" href="{% static 'css/sitecss/header-container.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block body %}
    <!-- Navigation Bar -->
   
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="page-title">
                <i class="fas fa-history"></i>
                <h1>Site Diary History</h1>
            </div>

            <div class="view-toggle">
                <button id="timelineViewBtn" class="view-btn active" title="Timeline View">
                    <i class="fas fa-stream"></i>
                </button>
                <button id="tableViewBtn" class="view-btn" title="Table View">
                    <i class="fas fa-table"></i>
                </button>
            </div>
        </div>

            <!-- Page Header already exists in your code -->
            
            <!-- Filter and Search Section -->
            <div class="filter-container">
                <div class="filter-header">
                    <div class="filter-title">
                        <i class="fas fa-filter"></i>
                        <span>Filter Entries</span>
                    </div>
                    <button class="filter-toggle" id="filterToggle">
                        <span>Show Filters</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Search entries...">
                </div>
                
                <div class="filter-options" id="filterOptions" style="display: none;">
                    <div class="filter-group">
                        <label for="filter-project">Project Name</label>
                        <select id="filter-project">
                            <option value="">All Projects</option>
                            <option value="Central Business District Tower">Central Business District Tower</option>
                            <option value="Highway Bridge Expansion">Highway Bridge Expansion</option>
                            <option value="Residential Complex Phase 2">Residential Complex Phase 2</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-date-from">Date From</label>
                        <input type="date" id="filter-date-from">
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-date-to">Date To</label>
                        <input type="date" id="filter-date-to">
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-weather">Weather Condition</label>
                        <select id="filter-weather">
                            <option value="">All Weather</option>
                            <option value="Sunny">Sunny</option>
                            <option value="Cloudy">Cloudy</option>
                            <option value="Rainy">Rainy</option>
                            <option value="Windy">Windy</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-personnel">Personnel</label>
                        <select id="filter-personnel">
                            <option value="">All Personnel</option>
                            <option value="John Smith">John Smith</option>
                            <option value="Sarah Johnson">Sarah Johnson</option>
                            <option value="Michael Brown">Michael Brown</option>
                        </select>
                    </div>
                    
                    <div class="filter-buttons">
                        <button class="btn btn-secondary" id="resetFilters">
                            <i class="fas fa-undo"></i>
                            Reset
                        </button>
                        <button class="btn btn-primary" id="applyFilters">
                            <i class="fas fa-check"></i>
                            Apply Filters
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Timeline View -->
            <div class="timeline-view" id="timelineView">
                <div class="timeline-line"></div>
                
                {% for entry in page_obj %}
                <!-- Timeline Item {{ forloop.counter }} -->
                <div class="timeline-item">
                    <div class="timeline-header" data-id="{{ entry.id }}">
                        <div class="timeline-date">
                            <i class="fas fa-calendar-alt"></i>
                            <div class="date-info">
                                <h3>{{ entry.project.name }}</h3>
                                <span>{{ entry.entry_date|date:"M d, Y" }}</span>
                            </div>
                        </div>
                        <div class="timeline-middle">
                            {% if entry.status == 'needs_revision' %}
                            <span class="status-badge status-revision-badge">Needs Revision</span>
                            {% endif %}
                            {% if entry.project.revision_count > 0 %}
                            <span class="status-badge budget-impact-badge">
                                <i class="fas fa-exclamation-triangle"></i>
                                Budget Impact: +₱{{ entry.project.revision_cost_impact|floatformat:0 }}
                            </span>
                            {% endif %}
                        </div>
                        <div class="timeline-actions">
                            <button class="action-btn download" title="Download PDF" onclick="downloadPDF({{ entry.id }}, '{{ entry.project.name|escapejs }}')">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                            <a href="{% url 'site_diary:revision_diary' entry.id %}" class="action-btn revision" title="Add Revision">
                                <i class="fas fa-history"></i>
                            </a>
                            <button class="action-btn expand" title="Expand/Collapse">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="timeline-content" id="content{{ entry.id }}">
                        <div class="project-info">
                            <div class="info-group">
                                <div class="info-label">Location</div>
                                <div class="info-value">{{ entry.project.location|default:"Not specified" }}</div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">Created By</div>
                                <div class="info-value">{{ entry.created_by.get_full_name|default:entry.created_by.username }}</div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">Progress</div>
                                <div class="info-value">{{ entry.progress_percentage }}%</div>
                            </div>
                            {% if entry.milestone %}
                            <div class="info-group">
                                <div class="info-label">Milestone</div>
                                <div class="info-value">{{ entry.milestone.name }}</div>
                            </div>
                            {% endif %}
                            <div class="info-group">
                                <div class="info-label">Status</div>
                                <div class="info-value">
                                    {% if entry.reviewed_by %}
                                        Reviewed by {{ entry.reviewed_by.get_full_name|default:entry.reviewed_by.username }}
                                        {% if entry.reviewed_date %}
                                            on {{ entry.reviewed_date|date:"M d, Y" }}
                                        {% endif %}
                                    {% else %}
                                        Pending Review
                                    {% endif %}
                                </div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">Entry Status</div>
                                <div class="info-value">
                                    <span class="status-badge {% if entry.status == 'complete' %}status-complete{% else %}status-revision{% endif %}">
                                        {{ entry.get_status_display }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Budget Impact Section -->
                        {% if entry.project.revision_count > 0 %}
                        <div class="budget-impact-info">
                            <div class="section-title">
                                <i class="fas fa-coins"></i>
                                <span>Budget Impact Analysis</span>
                            </div>
                            <div class="budget-details">
                                <div class="budget-item">
                                    <span class="budget-label">Original Budget:</span>
                                    <span class="budget-value">₱{{ entry.project.budget|floatformat:0 }}</span>
                                </div>
                                <div class="budget-item revision-impact">
                                    <span class="budget-label">Revision Impact:</span>
                                    <span class="budget-value impact-cost">+₱{{ entry.project.revision_cost_impact|floatformat:0 }}</span>
                                </div>
                                <div class="budget-item total">
                                    <span class="budget-label">Adjusted Budget:</span>
                                    <span class="budget-value">₱{{ entry.project.adjusted_budget|floatformat:0 }}</span>
                                </div>
                                <div class="budget-status">
                                    <span class="status-indicator {{ entry.project.budget_health }}">
                                        {% if entry.project.budget_health == 'good' %}
                                            <i class="fas fa-check-circle"></i> On Track
                                        {% elif entry.project.budget_health == 'warning' %}
                                            <i class="fas fa-exclamation-triangle"></i> At Risk
                                        {% else %}
                                            <i class="fas fa-times-circle"></i> Over Budget
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if entry.weather_condition %}
                        <div class="weather-info">
                            <i class="fas fa-{% if entry.weather_condition == 'sunny' %}sun{% elif entry.weather_condition == 'rainy' %}cloud-rain{% elif entry.weather_condition == 'cloudy' %}cloud{% elif entry.weather_condition == 'stormy' %}bolt{% elif entry.weather_condition == 'foggy' %}smog{% elif entry.weather_condition == 'windy' %}wind{% elif entry.weather_condition == 'snowy' %}snowflake{% else %}cloud{% endif %} weather-icon"></i>
                            <div class="weather-details">
                                <div class="weather-detail">
                                   
                                    <span>{{ entry.get_weather_condition_display }}</span>
                                </div>
                                {% if entry.temperature_high %}
                                <div class="weather-detail">
                                    <i class="fas fa-thermometer-half"></i>
                                    <span>High: {{ entry.temperature_high }}°C</span>
                                </div>
                                {% endif %}
                                {% if entry.temperature_low %}
                                <div class="weather-detail">
                                    <i class="fas fa-thermometer-quarter"></i>
                                    <span>Low: {{ entry.temperature_low }}°C</span>
                                </div>
                                {% endif %}
                                {% if entry.humidity %}
                                <div class="weather-detail">
                                    <i class="fas fa-tint"></i>
                                    <span>Humidity: {{ entry.humidity }}%</span>
                                </div>
                                {% endif %}
                                {% if entry.wind_speed %}
                                <div class="weather-detail">
                                    <i class="fas fa-wind"></i>
                                    <span>Wind: {{ entry.wind_speed }} km/h</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <div class="activities-section">
                            <div class="section-title">
                                <i class="fas fa-tasks"></i>
                                <span>Work Performed</span>
                            </div>
                            <p class="activity-text">
                                {{ entry.work_description|default:"No work description provided." }}
                            </p>
                        </div>
                        
                        <!-- Labor Summary -->
                        {% if entry.labor_entries.exists %}
                        <div class="activities-section">
                            <div class="section-title">
                                <i class="fas fa-users"></i>
                                <span>Labor Summary ({{ entry.labor_entries.count }} entries)</span>
                            </div>
                            <div class="labor-summary">
                                {% for labor in entry.labor_entries.all %}
                                <div class="labor-item">
                                    <span class="labor-type">{{ labor.trade_description }}</span>
                                    <span class="labor-count">{{ labor.workers_count }} workers</span>
                                    <span class="labor-hours">{{ labor.hours_worked }}h</span>
                                    {% if labor.overtime_hours %}
                                    <span class="labor-overtime">+{{ labor.overtime_hours }}h OT</span>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Materials Summary -->
                        {% if entry.material_entries.exists %}
                        <div class="activities-section">
                            <div class="section-title">
                                <i class="fas fa-boxes"></i>
                                <span>Materials ({{ entry.material_entries.count }} items)</span>
                            </div>
                            <div class="materials-summary">
                                {% for material in entry.material_entries.all %}
                                <div class="material-item">
                                    <span class="material-name">{{ material.material_name }}</span>
                                    <span class="material-quantity">{{ material.quantity_delivered }} {{ material.get_unit_display }}</span>
                                    {% if material.supplier %}
                                    <span class="material-supplier">from {{ material.supplier }}</span>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Equipment Summary -->
                        {% if entry.equipment_entries.exists %}
                        <div class="activities-section">
                            <div class="section-title">
                                <i class="fas fa-tools"></i>
                                <span>Equipment ({{ entry.equipment_entries.count }} items)</span>
                            </div>
                            <div class="equipment-summary">
                                {% for equipment in entry.equipment_entries.all %}
                                <div class="equipment-item">
                                    <span class="equipment-name">{{ equipment.equipment_name }}</span>
                                    <span class="equipment-hours">{{ equipment.hours_operated }}h</span>
                                    <span class="equipment-status status-{{ equipment.status }}">{{ equipment.get_status_display }}</span>
                                    {% if equipment.operator_name %}
                                    <span class="equipment-operator">Op: {{ equipment.operator_name }}</span>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Subcontractors Summary -->
                        {% if entry.subcontractor_entries.exists %}
                        <div class="activities-section">
                            <div class="section-title">
                                <i class="fas fa-handshake"></i>
                                <span>Subcontractors ({{ entry.subcontractor_entries.count }} companies)</span>
                            </div>
                            <div class="subcontractor-summary">
                                {% for sub in entry.subcontractor_entries.all %}
                                <div class="subcontractor-item">
                                    <span class="subcontractor-name">{{ sub.company_name }}</span>
                                    <span class="subcontractor-work">{{ sub.work_description }}</span>
                                    <span class="subcontractor-cost">₱{{ sub.daily_cost|floatformat:0 }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Delays Summary -->
                        {% if entry.delay_entries.exists %}
                        <div class="activities-section">
                            <div class="section-title">
                                <i class="fas fa-clock"></i>
                                <span>Delays ({{ entry.delay_entries.count }} incidents)</span>
                            </div>
                            <div class="delays-summary">
                                {% for delay in entry.delay_entries.all %}
                                <div class="delay-item">
                                    <span class="delay-category">{{ delay.get_category_display }}</span>
                                    <span class="delay-duration">{{ delay.duration_hours }}h</span>
                                    <span class="delay-impact impact-{{ delay.impact_level }}">{{ delay.get_impact_level_display }}</span>
                                    <span class="delay-description">{{ delay.description|truncatechars:50 }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Visitors Summary -->
                        {% if entry.visitor_entries.exists %}
                        <div class="activities-section">
                            <div class="section-title">
                                <i class="fas fa-user-friends"></i>
                                <span>Visitors ({{ entry.visitor_entries.count }} people)</span>
                            </div>
                            <div class="visitors-summary">
                                {% for visitor in entry.visitor_entries.all %}
                                <div class="visitor-item">
                                    <span class="visitor-name">{{ visitor.visitor_name }}</span>
                                    {% if visitor.company %}
                                    <span class="visitor-company">{{ visitor.company }}</span>
                                    {% endif %}
                                    <span class="visitor-type">{{ visitor.get_visitor_type_display }}</span>
                                    <span class="visitor-time">{{ visitor.arrival_time|time:"H:i" }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if entry.quality_issues or entry.safety_incidents %}
                        <div class="activities-section">
                            <div class="section-title">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Issues & Safety</span>
                            </div>
                            {% if entry.quality_issues %}
                            <div class="issue-item quality-issue">
                                <strong><i class="fas fa-tools"></i> Quality Issues:</strong>
                                <p>{{ entry.quality_issues }}</p>
                            </div>
                            {% endif %}
                            {% if entry.safety_incidents %}
                            <div class="issue-item safety-incident">
                                <strong><i class="fas fa-hard-hat"></i> Safety Incidents:</strong>
                                <p>{{ entry.safety_incidents }}</p>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if entry.general_notes %}
                        <div class="activities-section">
                            <div class="section-title">
                                <i class="fas fa-sticky-note"></i>
                                <span>General Notes</span>
                            </div>
                            <p class="activity-text">{{ entry.general_notes }}</p>
                        </div>
                        {% endif %}
                        
                        {% if entry.photos_taken or entry.photos.exists %}
                        <div class="activities-section">
                            <div class="section-title">
                                <i class="fas fa-camera"></i>
                                <span>Site Photos</span>
                            </div>
                            <div class="photo-gallery">
                                {% if entry.photos.exists %}
                                    {% for photo in entry.photos.all %}
                                    <div class="gallery-item">
                                        <img src="{{ photo.photo.url }}" alt="{{ photo.caption|default:'Site Photo' }}">
                                        {% if photo.caption %}
                                        <span class="photo-caption">{{ photo.caption }}</span>
                                        {% endif %}
                                        {% if photo.location %}
                                        <span class="photo-location">{{ photo.location }}</span>
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                {% else %}
                                <div class="gallery-item">
                                    <img src="{% static 'images/image3.jpg' %}" alt="Site Photo">
                                    <span class="photo-count">Photos Available</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <div class="timeline-item">
                    <div class="no-entries">
                        <i class="fas fa-calendar-times"></i>
                        <h3>No Diary Entries Found</h3>
                        <p>No diary entries match your current filters.</p>
                    </div>
                </div>
                {% endfor %}
                

            </div>
            
            <!-- Table View -->
            <div class="table-view" id="tableView">
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Project</th>
                                <th>Location</th>
                                <th>Weather</th>
                                <th>Created By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for entry in page_obj %}
                            <tr>
                                <td>{{ entry.entry_date|date:"M d, Y" }}</td>
                                <td class="table-project-name">{{ entry.project.name }}</td>
                                <td>{{ entry.project.location|default:"Not specified" }}</td>
                                <td>
                                    {% if entry.weather_condition %}
                                    <div class="table-weather">
                                        <i class="fas fa-{% if entry.weather_condition == 'sunny' %}sun{% elif entry.weather_condition == 'rainy' %}cloud-rain{% elif entry.weather_condition == 'cloudy' %}cloud{% else %}cloud{% endif %}"></i>
                                        <span>{{ entry.get_weather_condition_display }}{% if entry.temperature_high %}, {{ entry.temperature_high }}°C{% endif %}</span>
                                    </div>
                                    {% else %}
                                    <span class="text-muted">No data</span>
                                    {% endif %}
                                </td>
                                <td>{{ entry.created_by.get_full_name|default:entry.created_by.username }}</td>
                                <td>
                                    <div class="table-actions">
                                        <button class="action-btn download" title="Download PDF" onclick="downloadPDF({{ entry.id }}, '{{ entry.project.name|escapejs }}')">
                                            <i class="fas fa-file-pdf"></i>
                                        </button>
                                        <button class="action-btn view" title="View Details" onclick="viewEntry({{ entry.id }})" data-entry-id="{{ entry.id }}">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <a href="{% url 'site_diary:revision_diary' entry.id %}" class="action-btn revision" title="Add Revision">
                                            <i class="fas fa-history"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center">No diary entries found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Pagination Controls -->
            {% if page_obj.has_other_pages %}
            <div class="pagination">
                {% if page_obj.has_previous %}
                    <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page=1" class="page-btn">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                    <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}" class="page-btn">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                {% else %}
                    <button class="page-btn disabled">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                {% endif %}
                
                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                        <button class="page-btn active">{{ num }}</button>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ num }}" class="page-btn">{{ num }}</a>
                    {% endif %}
                {% endfor %}
                
                {% if page_obj.has_next %}
                    <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}" class="page-btn">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                    <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.paginator.num_pages }}" class="page-btn">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                {% else %}
                    <button class="page-btn disabled">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                {% endif %}
            </div>
            {% endif %}
            
            <!-- Entry Details Modal -->
            <div id="entryModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="modalTitle">
                            <i class="fas fa-file-alt"></i>
                            Entry Details
                        </h2>
                        <button class="close" id="closeEntryModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body" id="modalBody">
                        <div class="loading">Loading entry details...</div>
                    </div>
                    <div class="modal-footer" id="modalFooter" style="display: none;">
                        <!-- Footer buttons will be added here by JavaScript -->
                    </div>
                </div>
            </div>



        </div>
    </div> 
  
    
    <script src="{% static 'js/sitejs/history.js' %}"></script>
    <script>
        window.downloadPDF = function(entryId, projectName) {
            window.open('{% url "site_diary:diary_entry_pdf" 0 %}'.replace('0', entryId), '_blank');
        };
    </script>
    {% include "site_diary/navtemplate/layoutfooter.html" %}
{% endblock %}