{% extends "site_diary/layout_format.html" %}
{% load static %}

{% block head %}
    <title>Triple G BuildHub - Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/sitecss/global-footer.css' %}">
    <link rel="stylesheet" href="{% static 'css/sitecss/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/sitecss/createblog.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block body %}
    <div class="container">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="dashboard-title">
                <i class="fas fa-tachometer-alt"></i>
                <h1>Project Dashboard</h1>
            </div>
            <div class="user-info">
                <div class="user-greeting">
                    <div class="user-name">John Doe</div>
                    <div class="user-role">Project Manager</div>
                </div>
                <div class="user-avatar">JD</div>
            </div>
        </div>
        
        <!-- Dashboard Stats -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-building"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ stats.total_projects }}</div>
                    <div class="stat-label">Total Projects</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ stats.active_projects }}</div>
                    <div class="stat-label">Active Projects</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ stats.completed_projects }}</div>
                    <div class="stat-label">Completed Projects</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ stats.total_entries }}</div>
                    <div class="stat-label">Total Diary Entries</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ stats.planning_projects }}</div>
                    <div class="stat-label">Planning</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-pause-circle"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ stats.on_hold_projects }}</div>
                    <div class="stat-label">On Hold</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-edit"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ stats.draft_entries }}</div>
                    <div class="stat-label">Draft Entries</div>
                </div>
            </div>
        </div>

        <!-- Dashboard Controls -->
        <div class="dashboard-controls">
            <div class="controls-title">Current Projects</div>
            <div class="filter-controls">
                <select class="filter-dropdown">
                    <option value="">All Categories</option>
                    <option value="commercial">Commercial</option>
                    <option value="residential">Residential</option>
                    <option value="industrial">Industrial</option>
                    <option value="infrastructure">Infrastructure</option>
                </select>
                <select class="filter-dropdown">
                    <option value="">All Statuses</option>
                    <option value="planning">Planning</option>
                    <option value="ongoing">Ongoing</option>
                    <option value="review">Under Review</option>
                    <option value="completed">Completed</option>
                </select>
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Search projects...">
                </div>
            </div>
        </div>

        <!-- Enhanced Statistics Section -->
        {% if labor_stats or material_stats or equipment_stats %}
        <div class="enhanced-stats-section">
            <h3><i class="fas fa-chart-bar"></i> Detailed Statistics</h3>
            <div class="stats-row">
                {% if labor_stats %}
                <div class="stat-detail-card">
                    <div class="stat-detail-header">
                        <i class="fas fa-users"></i>
                        <h4>Labor Statistics</h4>
                    </div>
                    <div class="stat-detail-content">
                        <div class="stat-detail-item">
                            <span class="label">Total Workers:</span>
                            <span class="value">{{ labor_stats.total_workers|default:0 }}</span>
                        </div>
                        <div class="stat-detail-item">
                            <span class="label">Total Hours:</span>
                            <span class="value">{{ labor_stats.total_hours|default:0 }}</span>
                        </div>
                        <div class="stat-detail-item">
                            <span class="label">Average Hours:</span>
                            <span class="value">{{ labor_stats.avg_hours|default:0|floatformat:1 }}</span>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if material_stats %}
                <div class="stat-detail-card">
                    <div class="stat-detail-header">
                        <i class="fas fa-boxes"></i>
                        <h4>Material Statistics</h4>
                    </div>
                    <div class="stat-detail-content">
                        <div class="stat-detail-item">
                            <span class="label">Total Deliveries:</span>
                            <span class="value">{{ material_stats.total_deliveries|default:0 }}</span>
                        </div>
                        <div class="stat-detail-item">
                            <span class="label">Total Materials:</span>
                            <span class="value">{{ material_stats.total_materials|default:0 }}</span>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if equipment_stats %}
                <div class="stat-detail-card">
                    <div class="stat-detail-header">
                        <i class="fas fa-tools"></i>
                        <h4>Equipment Statistics</h4>
                    </div>
                    <div class="stat-detail-content">
                        <div class="stat-detail-item">
                            <span class="label">Total Equipment:</span>
                            <span class="value">{{ equipment_stats.total_equipment|default:0 }}</span>
                        </div>
                        <div class="stat-detail-item">
                            <span class="label">Total Hours:</span>
                            <span class="value">{{ equipment_stats.total_hours|default:0 }}</span>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Recent Activities Section -->
        {% if recent_entries or recent_delays %}
        <div class="recent-activities-section">
            <div class="activities-row">
                {% if recent_entries %}
                <div class="activity-card">
                    <div class="activity-header">
                        <i class="fas fa-book"></i>
                        <h4>Recent Diary Entries</h4>
                    </div>
                    <div class="activity-content">
                        {% for entry in recent_entries %}
                        <div class="activity-item">
                            <div class="activity-info">
                                <strong>{{ entry.project.name }}</strong>
                                <br>
                                <small>{{ entry.entry_date|date:"M d, Y" }} - {{ entry.created_by.get_full_name|default:entry.created_by.username }}</small>
                            </div>
                            <div class="activity-progress">
                                <span class="badge bg-primary">{{ entry.progress_percentage }}%</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if recent_delays %}
                <div class="activity-card">
                    <div class="activity-header">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h4>Recent Delays</h4>
                    </div>
                    <div class="activity-content">
                        {% for delay in recent_delays %}
                        <div class="activity-item">
                            <div class="activity-info">
                                <strong>{{ delay.diary_entry.project.name }}</strong>
                                <br>
                                <small>{{ delay.diary_entry.entry_date|date:"M d, Y" }} - {{ delay.get_category_display }}</small>
                            </div>
                            <div class="activity-progress">
                                <span class="badge 
                                    {% if delay.impact_level == 'low' %}bg-success
                                    {% elif delay.impact_level == 'medium' %}bg-warning
                                    {% elif delay.impact_level == 'high' %}bg-danger
                                    {% else %}bg-secondary{% endif %}">
                                    {{ delay.duration_hours }}h
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
        
        <!-- Project Grid -->
        <div class="project-grid">
            {% if project_cards and project_cards|length > 0 %}
                {% for p in project_cards %}
                <div class="project-card">
                    <img src="{% static 'images/image' %}{{ forloop.counter }}.jpg" alt="{{ p.project.name }}" class="project-image">
                    <div class="project-content">
                        <h3 class="project-title">{{ p.project.name }}</h3>
                        <p class="project-description">{{ p.project.description|default:'No description.' }}</p>
                        <div class="progress-container">
                            <div class="progress-label">PROGRESS:</div>
                            <div class="progress-track">
                                <div class="progress-bar" style="width: {{ p.latest_entry.progress_percentage|default:0 }}%;"></div>
                            </div>
                        </div>
                        <div class="card-actions">
                            <a href="{% url 'site_diary:project_detail' p.project.id %}" class="btn btn-primary">See Details</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-projects">No projects available. Create a new project to get started.</div>
            {% endif %}
        </div>

        
    </div>
   

    <!-- Scripts -->
    <script src="{% static 'js/sitejs/dashboardjs' %}"></script>
    <script src="./sitecss/sitejs/chatarkside.js"></script>
    <!-- loader.js will be loaded by loader-init.js -->
    {% include "site_diary/navtemplate/layoutfooter.html" %}
{% endblock %}
